<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulmo - AI Voice Agent | Techfest IIT Bombay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');
        
        body {
            font-family: 'Orbitron', sans-serif;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.5), 0 0 40px rgba(239, 68, 68, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(239, 68, 68, 0.8), 0 0 60px rgba(239, 68, 68, 0.5);
            }
        }
        
        .glow-border {
            animation: glow 2s ease-in-out infinite;
        }
        
        .hexagon {
            clip-path: polygon(30% 0%, 70% 0%, 100% 50%, 70% 100%, 30% 100%, 0% 50%);
        }
        
        .cyber-border {
            position: relative;
            border: 2px solid #ef4444;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 27, 75, 0.9));
        }
        
        .cyber-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ef4444, #3b82f6, #ef4444);
            z-index: -1;
            border-radius: inherit;
            opacity: 0.3;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
        
        .wave-bar {
            animation: wave 0.6s ease-in-out infinite;
        }
    </style>
</head>
<body class="m-0 p-0 bg-slate-950">
    <div id="app"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function VulmoApp() {
            const [isListening, setIsListening] = useState(false);
            const [transcript, setTranscript] = useState('');
            const [displayText, setDisplayText] = useState('');
            const [conversation, setConversation] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [error, setError] = useState('');
            const recognitionRef = useRef(null);

            useEffect(() => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognitionRef.current = new SpeechRecognition();
                    recognitionRef.current.continuous = false;
                    recognitionRef.current.interimResults = true;
                    recognitionRef.current.lang = 'en-US';

                    recognitionRef.current.onresult = (event) => {
                        let finalText = '';
                        let interimText = '';

                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const text = event.results[i][0].transcript;
                            if (event.results[i].isFinal) {
                                finalText += text;
                            } else {
                                interimText += text;
                            }
                        }

                        const currentText = finalText || interimText;
                        setTranscript(currentText);
                        setDisplayText(currentText);
                        
                        if (finalText) {
                            setIsListening(false);
                            processVoiceInput(finalText);
                        }
                    };

                    recognitionRef.current.onerror = (event) => {
                        console.error('Speech error:', event.error);
                        setError(`Error: ${event.error}`);
                        setIsListening(false);
                    };

                    recognitionRef.current.onend = () => {
                        setIsListening(false);
                    };
                }

                return () => {
                    if (recognitionRef.current) {
                        recognitionRef.current.stop();
                    }
                    window.speechSynthesis.cancel();
                };
            }, []);

            const getGreeting = () => {
                const hour = new Date().getHours();
                if (hour < 12) return 'Good morning';
                if (hour < 17) return 'Good afternoon';
                return 'Good evening';
            };

            const handleBasicQueries = (input) => {
                const lowerInput = input.toLowerCase().trim();
                
                // Greetings
                if (lowerInput.match(/^(hi|hello|hey|good morning|good afternoon|good evening)$/)) {
                    return `${getGreeting()}! I'm Vulmo, your AI voice assistant. How can I help you today?`;
                }
                
                // Time-based greetings
                if (lowerInput.includes('good morning')) {
                    return 'Good morning! Hope you have a wonderful day ahead! What can I do for you?';
                }
                if (lowerInput.includes('good afternoon')) {
                    return 'Good afternoon! How can I assist you today?';
                }
                if (lowerInput.includes('good evening')) {
                    return 'Good evening! How may I help you?';
                }
                
                // About Vulmo
                if (lowerInput.includes('who are you') || lowerInput.includes('what are you')) {
                    return 'I am Vulmo, an AI-powered voice assistant built for the Murf Voice Agent Hackathon at Techfest IIT Bombay. I can chat with you using voice or text!';
                }
                
                // What can you do
                if (lowerInput.includes('what can you do') || lowerInput.includes('help')) {
                    return 'I can have conversations with you through voice or text, answer questions, tell jokes, and help with various tasks. Just speak to me or type your message!';
                }
                
                // How are you
                if (lowerInput.includes('how are you')) {
                    return 'I\'m doing great, thank you for asking! How are you doing today?';
                }
                
                // Thank you
                if (lowerInput.match(/^(thanks|thank you|thanks a lot)$/)) {
                    return 'You\'re welcome! Happy to help!';
                }
                
                // Goodbye
                if (lowerInput.match(/^(bye|goodbye|see you)$/)) {
                    return 'Goodbye! Have a great day!';
                }
                
                return null;
            };

            const startListening = () => {
                setError('');
                setTranscript('');
                setDisplayText('');
                
                if (!recognitionRef.current) {
                    setError('Speech recognition not supported');
                    return;
                }

                try {
                    recognitionRef.current.start();
                    setIsListening(true);
                } catch (err) {
                    setError('Failed to start listening');
                }
            };

            const stopListening = () => {
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                }
                setIsListening(false);
            };

            const processVoiceInput = async (input) => {
                if (!input.trim()) return;

                setIsProcessing(true);
                setError('');

                // Check for basic queries first
                const basicResponse = handleBasicQueries(input);
                
                if (basicResponse) {
                    setDisplayText(basicResponse);
                    speakText(basicResponse);
                    setIsProcessing(false);
                    return;
                }

                // Use AI for complex queries
                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1000,
                            messages: [
                                ...conversation,
                                {
                                    role: 'user',
                                    content: input
                                }
                            ],
                            system: 'You are Vulmo, a friendly AI voice assistant for Techfest IIT Bombay. Respond briefly and conversationally, keeping answers concise (2-3 sentences max) since they will be spoken aloud. Be helpful, friendly, and enthusiastic.'
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || `API error: ${response.status}`);
                    }

                    const data = await response.json();
                    const aiText = data.content
                        .filter(item => item.type === 'text')
                        .map(item => item.text)
                        .join('');
                    
                    setDisplayText(aiText);
                    setConversation(prev => [
                        ...prev,
                        { role: 'user', content: input },
                        { role: 'assistant', content: aiText }
                    ]);
                    speakText(aiText);
                } catch (err) {
                    console.error('API Error:', err);
                    const errMsg = 'Sorry, I encountered an error. Please try again.';
                    setDisplayText(errMsg);
                    setError(err.message || 'Failed to process request');
                }

                setIsProcessing(false);
            };

            const speakText = (text) => {
                if (!('speechSynthesis' in window)) return;

                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.95;
                utterance.pitch = 1.0;
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => setIsSpeaking(false);
                utterance.onerror = () => setIsSpeaking(false);
                window.speechSynthesis.speak(utterance);
            };

            const sendMessage = () => {
                if (transcript.trim() && !isProcessing) {
                    processVoiceInput(transcript);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white p-4 md:p-8 flex flex-col">
                    <div className="max-w-5xl mx-auto w-full flex-1 flex flex-col">
                        {/* Header */}
                        <div className="text-center mb-12">
                            <div className="flex items-center justify-center gap-4 mb-4">
                                <div className="w-16 h-16 hexagon bg-gradient-to-br from-red-500 to-blue-500 flex items-center justify-center">
                                    <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                </div>
                                <h1 className="text-7xl font-black tracking-wider">
                                    <span className="text-red-500">VUL</span>
                                    <span className="text-blue-500">MO</span>
                                </h1>
                            </div>
                            <p className="text-xl text-gray-300 tracking-wide mb-2">AI VOICE AGENT</p>
                            <p className="text-sm text-red-400 font-semibold tracking-widest">TECHFEST IIT BOMBAY</p>
                        </div>

                        {/* Main Interface */}
                        <div className="cyber-border rounded-lg p-8 mb-8 flex-1 flex flex-col glow-border">
                            <div className="text-center flex-1 flex flex-col justify-center">
                                {/* Voice Control Section */}
                                <div className="mb-8">
                                    <h2 className="text-2xl font-bold mb-6 text-red-400 tracking-wider">VOICE CONTROL</h2>
                                    
                                    <div className="relative inline-block mb-6">
                                        <button
                                            onClick={isListening ? stopListening : startListening}
                                            disabled={isProcessing}
                                            className={`w-40 h-40 rounded-full flex items-center justify-center transition-all duration-300 border-4 ${
                                                isListening 
                                                    ? 'bg-red-600 border-red-400 shadow-2xl scale-110 animate-pulse' 
                                                    : 'bg-gradient-to-br from-slate-800 to-slate-700 border-red-500 hover:scale-105 hover:border-blue-500'
                                            } ${isProcessing ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}
                                        >
                                            {isProcessing ? (
                                                <svg className="w-16 h-16 animate-spin text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                            ) : isListening ? (
                                                <svg className="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                                                </svg>
                                            ) : (
                                                <svg className="w-16 h-16 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                                                </svg>
                                            )}
                                        </button>
                                        
                                        {isListening && (
                                            <>
                                                <div className="absolute inset-0 rounded-full border-4 border-red-400 pulse-ring"></div>
                                                <div className="flex items-center justify-center gap-1 mt-4">
                                                    {[0, 1, 2, 3, 4].map((i) => (
                                                        <div
                                                            key={i}
                                                            className="w-1 h-8 bg-red-400 rounded wave-bar"
                                                            style={{ animationDelay: `${i * 0.1}s` }}
                                                        ></div>
                                                    ))}
                                                </div>
                                            </>
                                        )}
                                    </div>

                                    <p className="text-lg font-bold mb-4 tracking-wide">
                                        {isProcessing ? '‚öôÔ∏è PROCESSING...' : 
                                         isListening ? 'üé§ LISTENING...' : 
                                         isSpeaking ? 'üîä SPEAKING...' :
                                         'üëÜ TAP TO SPEAK'}
                                    </p>

                                    {error && (
                                        <p className="text-red-400 text-sm mt-4 bg-red-900 bg-opacity-30 px-4 py-2 rounded-lg border border-red-500 inline-block">
                                            {error}
                                        </p>
                                    )}
                                </div>

                                {/* Display Box */}
                                <div className="max-w-2xl mx-auto w-full mb-6">
                                    <div className="bg-slate-950 border-2 border-blue-500 rounded-lg p-6 min-h-32">
                                        {displayText ? (
                                            <p className="text-lg text-gray-200 leading-relaxed">{displayText}</p>
                                        ) : (
                                            <p className="text-gray-500 text-sm tracking-wide">
                                                {isListening 
                                                    ? 'Speak now... your words will appear here' 
                                                    : 'Tap the microphone and start speaking...'}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* Text Input */}
                                <div className="max-w-2xl mx-auto w-full">
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={transcript}
                                            onChange={(e) => setTranscript(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                            placeholder="OR TYPE YOUR MESSAGE..."
                                            disabled={isProcessing || isListening}
                                            className="flex-1 px-4 py-3 bg-slate-900 border-2 border-red-500 rounded-lg focus:outline-none focus:border-blue-500 text-white placeholder-gray-500 disabled:opacity-50 font-semibold tracking-wide"
                                        />
                                        <button
                                            onClick={sendMessage}
                                            disabled={!transcript.trim() || isProcessing || isListening}
                                            className="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all border-2 border-red-400"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Stats Section */}
                        <div className="grid grid-cols-3 gap-6 mb-8">
                            <div className="cyber-border rounded-lg p-6 text-center">
                                <div className="text-4xl font-black text-red-400 mb-2">24/7</div>
                                <p className="text-sm tracking-wider text-gray-400">AVAILABILITY</p>
                            </div>
                            <div className="cyber-border rounded-lg p-6 text-center">
                                <div className="text-4xl font-black text-blue-400 mb-2">AI</div>
                                <p className="text-sm tracking-wider text-gray-400">POWERED</p>
                            </div>
                            <div className="cyber-border rounded-lg p-6 text-center">
                                <div className="text-4xl font-black text-red-400 mb-2">VOICE</div>
                                <p className="text-sm tracking-wider text-gray-400">ENABLED</p>
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="text-center">
                            <p className="text-gray-400 text-sm tracking-wider">
                                BUILT FOR MURF VOICE AGENT HACKATHON ‚Ä¢ TECHFEST IIT BOMBAY
                            </p>
                            <div className="flex items-center justify-center gap-8 mt-4 text-xs text-gray-500">
                                <div>
                                    <p className="font-bold">Dhruvam Vaghasiya</p>
                                    <p>+91 9359243212</p>
                                    <p>dhruvam@techfest.org</p>
                                </div>
                                <div className="w-px h-12 bg-red-500"></div>
                                <div>
                                    <p className="font-bold">Prajwal Talwalkar</p>
                                    <p>+91 9423115250</p>
                                    <p>prajwal@techfest.org</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<VulmoApp />, document.getElementById('app'));
    </script>
</body>
</html>